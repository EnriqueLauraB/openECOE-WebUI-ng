
<button *ngIf="!preview" nz-button nzType="dashed" nzBlock (click)="addQuestion()">
  <i nz-icon [type]="'plus-circle'"></i>
  {{'ADD_QUESTION' | translate}}
</button>
<nz-table #table
          [nzData]="questionsList"
          [(nzPageIndex)]="page"
          [(nzPageSize)]="perPage"
          (nzPageIndexChange)="pageChange($event)"
          (nzPageSizeChange)="pageSizeChange($event)"
          [nzLoading]="loading"
          [nzTotal]="totalItems"
          [nzFrontPagination]="false"
          nzSize="small"
          nzShowSizeChanger
          [nzShowPagination]="preview ? false : true"
          >
  <thead>
  <tr>
    <th nzWidth="40px">{{"ORDER" | translate}}</th>
    <th nzWidth="400px">{{"DESCRIPTION" | translate}}</th>
    <th nzWidth="150px">{{"REFERENCE" | translate}}</th>
    <th>{{"AREA" | translate}}</th>
    <th>{{"QUESTION_TYPE" | translate}}</th>
    <th nzAlign="right">
      <!---->
    </th>
  </tr>
  </thead>

  <tbody>
  <ng-template ngFor let-item let-index="index" [ngForOf]="table.data" >
<!--  <ng-template *ngFor="let item of table.data; let index" >-->
    <!--<h1>{{table.data.length}}</h1>-->
    <tr>
      <td nzAlign="right">
        <ng-template [ngIf]="!editCache[item.id]?.edit" [ngIfElse]="editOrder">
          {{item.order || "-"}}
        </ng-template>

        <ng-template #editOrder>
          <nz-input-number [nzMin]="0"
                           [nzSize]="'small'"
                           [(ngModel)]="editCache[item.id].item.order">
          </nz-input-number>
        </ng-template>
      </td>

      <td>
        <ng-container *ngIf="!editCache[item.id]?.edit else editDesc">
          {{item.description}}
        </ng-container>

        <ng-template #editDesc>
          <textarea rows="1" [nzAutosize]="true" nz-input [(ngModel)]="editCache[item.id].item.description"></textarea>
        </ng-template>
      </td>

      <td>
        <ng-container *ngIf="!editCache[item.id]?.edit else editRef">
          {{item.reference}}
        </ng-container>

        <ng-template #editRef>
          <input type="text" nz-input [nzSize]="'small'" [(ngModel)]="editCache[item.id].item.reference">
        </ng-template>
      </td>

      <td>
        <ng-container *ngIf="!editCache[item.id]?.edit else editArea">
          {{item.area?.name}}
        </ng-container>

        <ng-template #editArea>
          <nz-select style="width: 100%;"
                     [nzSize]="'small'"
                     [nzShowSearch]="true"
                     [(ngModel)]="editCache[item.id].item.area"
                     (nzScrollToBottom)="loadMoreAreas()"
          >
            <nz-option *ngFor="let area of areas" [nzLabel]="area.name" [nzValue]="area">
            </nz-option>
          </nz-select>
        </ng-template>
      </td>

      <td>
        <ng-container *ngIf="!editCache[item.id]?.edit">
          {{getQuestionTypeLabel(item.questionType) | translate}}
        </ng-container>

        <ng-container *ngIf="editCache[item.id]?.edit">
          <nz-select style="width: 100%;"
                     [nzSize]="'small'"
                     [nzShowSearch]="true"
                     [(ngModel)]="editCache[item.id].item.questionType">
            <nz-option *ngFor="let option of questionTypeOptions"
                       [nzLabel]="option.label | translate"
                       [nzValue]="option.type">
            </nz-option>
          </nz-select>
        </ng-container>
      </td>

      <td text-right>
        <nz-tag
          [nzColor]="item.options?.length === 0 ? 'red' : 'geekblue'"
          (click)="editCache[item.id].expand = !editCache[item.id].expand">
          <i nz-icon [type]="editCache[item.id]?.expand ? 'caret-down' : 'caret-right'"></i>
          {{item.options.length}} {{(item.options.length === 1 ? 'OPTION' : 'OPTIONS') | translate}}
        </nz-tag>
        <ng-container *ngIf="!preview">
          <nz-divider [nzType]="'vertical'"></nz-divider>
          <app-action-buttons
            [isEditing]="editCache[item.id]?.edit"
            [isNewItem]="editCache[item.id]?.new_item"
            (startEdit)="startEdit(item.id)"
            (delete)="deleteItem(item.id)"
            (save)="saveItem(editCache[item.id])"
            (cancelEdit)="cancelEdit(item.id)">
          </app-action-buttons>
        </ng-container>
      </td>
    </tr>
    <tr [nzExpand]="editCache[item.id]?.expand">
      <td></td>
      <td colspan="5">
        <app-options-list
          [question]="item"
          [preview]="preview">

        </app-options-list>
      </td>
    </tr>
  </ng-template>

  </tbody>
</nz-table>

