<nz-table #table
          [nzData]="users"
          [(nzPageIndex)]="page"
          [(nzPageSize)]="perPage"
          (nzPageIndexChange)="pageChange($event)"
          (nzPageSizeChange)="pageSizeChange($event)"
          [nzLoading]="loading"
          [nzFrontPagination]="false"
          [nzTotal]="totalItems"
          nzShowSizeChanger
          nzShowPagination>
  <thead>
  <tr>
    <th [nzExpand]="true">
      <a (click)="loadUsers()">
        <i nz-icon icon-25 type="reload" [nz-tooltip] [nzPlacement]="'bottom'" [nzTitle]="'REFRESH' | translate"></i>
      </a>
    </th>
    <th>{{"EMAIL" | translate}}</th>
    <th>{{"NAME" | translate}}</th>
    <th>{{"SURNAME" | translate}}</th>
    <th nzWidth="240px">
      <nz-button-group>
        <button nz-button [nzType]="'primary'" class="margin-left"
                [nz-tooltip] [nzTitle]="'ADD_USER' | translate"
                (click)="addUser()">
          <i nz-icon nzType="plus-circle" nzTheme="twotone" icon-16></i>
        </button>
        <app-upload-and-parse (parserResult)="importUsers($event)"></app-upload-and-parse>
      </nz-button-group>
    </th>
  </tr>
  </thead>

  <tbody>
  <ng-template ngFor let-item let-idx="index" [ngForOf]="table.data">
    <tr>
      <td>
        <ng-container>
          {{item.id}}
        </ng-container>
      </td>

      <td>
        <ng-container *ngIf="!editCache[idx].edit; else editEmail">
          {{item.email}}
          <nz-tag *ngIf="item.isSuperadmin"
                  nzColor="geekblue"
          >
            {{"USER_ADMIN" | translate}}
          </nz-tag>
        </ng-container>
        <ng-template #editEmail>
          <input type="text" nz-input [nzSize]="'small'" [(ngModel)]="editCache[idx].item.email">
        </ng-template>
      </td>

      <td>
        <ng-container *ngIf="!editCache[idx].edit; else editName">
          {{item.name}}
        </ng-container>
        <ng-template #editName>
          <input type="text" nz-input [nzSize]="'small'" [(ngModel)]="editCache[idx].item.name">
        </ng-template>
      </td>

      <td>
        <ng-container *ngIf="!editCache[idx].edit; else editSurname">
          {{item.surname}}
        </ng-container>
        <ng-template #editSurname>
          <input type="text" nz-input [nzSize]="'small'" [(ngModel)]="editCache[idx].item.surname">
        </ng-template>
      </td>
      <td text-right>
        <app-action-buttons [isEditing]="editCache[idx].edit"
                            [isNewItem]="editCache[idx].new_item"
                            (startEdit)="editUser(idx)"
                            (delete)="delUser(idx)"
                            (save)="saveUser(idx)"
                            (cancelEdit)="cancelUser(idx)">
        </app-action-buttons>
      </td>
    </tr>
  </ng-template>
  </tbody>
</nz-table>
